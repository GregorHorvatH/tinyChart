"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function ownKeys(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,c)}return i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Chart=function t(e){var T=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,t),this.onMouseDown=function(t){var e=t.clientX;T.isPressed=!0,T.recX1=~~e-T.clientRect.left,T.recX1=T.recX1<T.MARGIN_LEFT?T.MARGIN_LEFT:T.recX1,T.recX1=T.recX1>T.ctxWidth-T.MARGIN_RIGHT?T.ctxWidth-T.MARGIN_RIGHT:T.recX1,T.recX2=T.recX1},this.onMouseUp=function(){T.isPressed=!1,T.filterPoints(),T.draw()},this.onMouseMove=function(t){var e=t.clientX,i=t.clientY;T.isPressed&&(T.zoom=!0),T.pointerX=~~(e-T.clientRect.left),T.pointerY=~~(i-T.clientRect.top),T.isPressed?(T.recX2=T.pointerX<T.MARGIN_LEFT?T.MARGIN_LEFT:T.pointerX,T.recX2=T.recX2>T.ctxWidth-T.MARGIN_RIGHT?T.ctxWidth-T.MARGIN_RIGHT:T.recX2,T.draw(T.ctx,T.points,T.colors),T.drawSelector()):T.draw(T.ctx,T.points,T.colors)},this.onTouchStart=function(t){var e=t.touches;T.onMouseDown({clientX:e[0].clientX})},this.onTouchMove=function(t){var e=t.touches;T.onMouseMove({clientX:e[0].clientX,clientY:e[0].clientY})},this.onTouchEnd=function(){T.onMouseUp()},this.draw=function(){T.setBackgroundSize(),T.drawBackground(),T.points=T.calcPoints(T.zoom?T.points:T.rawPoints),T.drawChart()},this.setBackgroundSize=function(){T.width=(T.options.width||T.parent.clientWidth)*T.ratio,T.height=(T.options.height||T.DEFAULT_HEIGHT)*T.ratio,T.ctxWidth=T.width/T.ratio,T.ctxHeight=T.height/T.ratio,T.canvas.style.width="".concat(T.parent.clientWidth,"px"),T.canvas.style.height="".concat(T.DEFAULT_HEIGHT,"px"),T.canvas.setAttribute("width",T.width),T.canvas.setAttribute("height",T.height),T.ctx.scale(T.ratio,T.ratio)},this.drawBackground=function(){T.stepX=(T.ctxWidth-T.MARGIN_LEFT-T.MARGIN_RIGHT)/(T.linesX-1),T.stepY=(T.ctxHeight-T.MARGIN_TOP-T.MARGIN_BOTTOM)/(T.linesY-1),T.ctx.clearRect(0,0,T.ctxWidth,T.ctxHeight);var t=(T.DEFAULT_HEIGHT-T.MARGIN_BOTTOM)/-2;T.ctx.fillStyle="#000",T.ctx.save(),T.ctx.rotate(270*Math.PI/180),T.ctx.textAlign="center",T.ctx.font="20px sans-serif",T.ctx.fillStyle="#00458B",T.ctx.fillText(T.options.description||"",t,15),T.ctx.restore();for(var e=0;e<T.linesY;e++){var i=T.MARGIN_TOP+T.stepY*e;T.ctx.beginPath(),T.ctx.lineWidth=e<T.linesY-1?.2:1,T.ctx.moveTo(T.MARGIN_LEFT-7,i),T.ctx.lineTo(T.ctxWidth-T.MARGIN_RIGHT,i),T.ctx.stroke(),T.ctx.closePath()}for(var c=0;c<T.linesX;c++){var o=T.MARGIN_LEFT+T.stepX*c;T.ctx.beginPath(),T.ctx.lineWidth=0<c?.2:1,T.ctx.moveTo(o,T.MARGIN_TOP),T.ctx.lineTo(o,T.ctxHeight-T.MARGIN_BOTTOM),T.ctx.stroke(),T.ctx.closePath()}},this.drawSelector=function(){T.ctx.beginPath(),T.ctx.fillStyle="rgba(0, 0, 255, .1)",T.ctx.fillRect(T.recX1,T.MARGIN_TOP,T.recX2-T.recX1,T.ctxHeight-T.MARGIN_BOTTOM-T.MARGIN_TOP),T.ctx.stroke(),T.ctx.closePath()},this.drawChart=function(){T.ctx.lineWidth=1;for(var t=0;t<T.points[0].y.length;t++){T.ctx.beginPath(),T.ctx.strokeStyle=T.colors[t]||"#000",T.ctx.moveTo(T.points[0].x,T.points[0].y[t]);for(var e=0;e<T.points.length;e++)if(e)switch(T.chartTypes[t]){case 1:T.ctx.lineTo(T.points[e].x,T.points[e-1].y[t]),T.ctx.lineTo(T.points[e].x,T.points[e].y[t]);break;default:T.ctx.lineTo(T.points[e].x,T.points[e].y[t])}T.ctx.stroke(),T.ctx.closePath()}T.zeroY<T.ctxHeight-T.MARGIN_BOTTOM&&(T.ctx.beginPath(),T.ctx.lineWidth=1,T.ctx.strokeStyle="#4aa8ff",T.ctx.setLineDash([5,10]),T.ctx.moveTo(T.MARGIN_LEFT+1,T.zeroY),T.ctx.lineTo(T.ctxWidth-T.MARGIN_RIGHT-1,T.zeroY),T.ctx.stroke(),T.ctx.closePath(),T.ctx.setLineDash([])),T.points.forEach(function(t){t.isSelected&&(T.ctx.beginPath(),T.ctx.lineWidth=3,T.ctx.strokeStyle="#ebc1be",T.ctx.moveTo(t.x,T.MARGIN_TOP+1),T.ctx.lineTo(t.x,T.ctxHeight-T.MARGIN_BOTTOM-1),T.ctx.stroke(),T.ctx.closePath())}),T.ctx.lineWidth=1,T.points.forEach(function(i){i.y.forEach(function(t,e){T.ctx.beginPath(),T.ctx.strokeStyle=T.colors[e]||"#000",T.ctx.fillStyle=T.colors[e]||"#000",T.ctx.arc(i.x,t,i.isSelected?6:4,0,2*Math.PI),T.ctx.fill(),T.ctx.stroke(),T.ctx.closePath()})}),T.ctx.strokeStyle="#000",T.ctx.fillStyle="#000",T.ctx.font="12px sans-serif",T.ctx.beginPath();for(var i=(T.maxY-T.minY)/(T.linesY-1),c=0;c<T.linesY;c++){var o=~~(T.minY+i*c),n="".concat(o).concat(T.symbols[0]||"");T.ctx.fillText(n,T.MARGIN_LEFT-T.ctx.measureText(n).width-3,T.ctxHeight-T.MARGIN_BOTTOM-T.stepY*c)}T.ctx.stroke(),T.ctx.closePath(),T.ctx.font="12px sans-serif";for(var r=(T.points[T.points.length-1].time-T.points[0].time)/(T.linesX-1),s=0;s<T.linesX;s++){var a=new Date(T.points[0].time+~~(r*s));T.ctx.save(),T.ctx.beginPath(),T.ctx.translate(T.MARGIN_LEFT-35+s*T.stepX,T.ctxHeight-T.MARGIN_BOTTOM+60),T.ctx.rotate(300*Math.PI/180),T.ctx.fillText(T.formatDateTime(a,!0),0,0),T.ctx.fillText(T.formatDateTime(a),25,12),T.ctx.stroke(),T.ctx.closePath(),T.ctx.restore()}var l=50,h=0,x=0;T.ctx.font="bold 14px sans-serif";for(var f=0;f<T.points[0].value.length;f++){var d="".concat(T.labels[f]||"input "+(f+1));h+=T.ctx.measureText(d).width+l,T.labels[f]=T.labels[f]||"input ".concat(f+1)}for(var u=(T.ctxWidth-h)/2,p=0;p<T.points[0].value.length;p++){x+=p?T.ctx.measureText(T.labels[p-1]).width+l:l,T.ctx.beginPath(),T.ctx.lineWidth=1,T.ctx.fillStyle="#000",T.ctx.fillText(T.labels[p],u+x,T.ctxHeight-4),T.ctx.lineWidth=3,T.ctx.fillStyle=T.colors[p]||"#000",T.ctx.strokeStyle=T.colors[p]||"#000",T.ctx.moveTo(u+x-l+10,T.ctxHeight-8),T.ctx.lineTo(u+x-5,T.ctxHeight-8),T.ctx.arc(u+x-l+10+17.5,T.ctxHeight-8,4,0,2*Math.PI),T.ctx.fill(),T.ctx.stroke(),T.ctx.closePath()}T.points.forEach(function(t){if(t.isSelected){var e=t.time,i=t.value,c=20*t.y.length+20+10,r=T.pointerX>T.ctxWidth-T.MARGIN_RIGHT-140?-145:10,o=new Date(e),n=T.pointerY+10+20,s=T.pointerY+10+40;T.ctx.beginPath(),T.ctx.lineWidth=1,T.ctx.strokeStyle="#0000ff",T.ctx.fillStyle="rgba(255, 255, 255, .9)",T.ctx.fillRect(T.pointerX+r,T.pointerY+10,140,c),T.ctx.rect(T.pointerX+r,T.pointerY+10,140,c),T.ctx.fillStyle="#000",T.ctx.font="14px sans-serif",T.ctx.fillText(T.formatDateTime(o,!0),T.pointerX+r+5,n),T.ctx.fillStyle="#ff0000",T.ctx.font="bold 14px sans-serif",T.ctx.fillText(T.formatDateTime(o),T.pointerX+r+80,n),i.map(function(t,e){return{value:t,color:T.colors[e]||"#000",label:"".concat(T.labels[e]||"input "+(e+1)),symbol:T.symbols[e]||""}}).sort(function(t,e){return e.value-t.value}).forEach(function(t){var e=t.value,i=t.color,c=t.label,o=t.symbol,n=T.ctx.measureText(c).width+10;T.ctx.fillStyle=i,T.ctx.font="14px sans-serif",T.ctx.shadowColor="#777777",T.ctx.shadowOffsetX=1,T.ctx.shadowOffsetY=1,T.ctx.shadowBlur=1,T.ctx.fillText("".concat(c,":"),T.pointerX+r+5,s),T.ctx.fillStyle="#000",T.ctx.shadowOffsetX=0,T.ctx.shadowOffsetY=0,T.ctx.font="bold 14px sans-serif",T.ctx.fillText("".concat(e," ").concat(o),T.pointerX+r+n,s),s+=20}),T.ctx.stroke(),T.ctx.closePath()}})},this.resetPoints=function(){T.points=T.rawPoints,T.zoom=!1,T.draw()},this.filterPoints=function(){var e=T.recX1<T.recX2?T.recX1:T.recX2,i=T.recX1>T.recX2?T.recX1:T.recX2,t=T.points.filter(function(t){return t.x>=e&&t.x<=i});T.points=t.length?t:T.points},this.calcPoints=function(o){var n=[],r=o[o.length-1].time-o[0].time;return T.minY=o[0].value[0],T.maxY=o[0].value[0],o.forEach(function(t){var e=t.time,i=t.value,c=T.MARGIN_LEFT+15+~~((e-o[0].time)*(T.ctxWidth-T.MARGIN_LEFT-T.MARGIN_RIGHT-30)/r);n.push(_objectSpread({},t,{isSelected:T.pointerX>=c-10&&T.pointerX<=c+10,x:c})),i.forEach(function(t,e){var i=t/(T.delimiters[e]||1);i<T.minY&&(T.minY=i),i>T.maxY&&(T.maxY=i)})}),T.zeroY=T.calcY(0),n.forEach(function(c){var t=c.value;c.y=[],t.forEach(function(t,e){var i=T.delimiters[e]||1;c.y.push(T.calcY(t/i))})}),n},this.calcY=function(t){var e=T.maxY-T.minY;return T.ctxHeight-~~((t-T.minY)*(T.ctxHeight-T.MARGIN_TOP-T.MARGIN_BOTTOM)/e)-T.MARGIN_BOTTOM},this.formatDateTime=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=t.getFullYear(),c=t.getMonth(),o=t.getDate(),n=t.getHours(),r=t.getMinutes(),s=t.getSeconds();return n=n<10?"0"+n:n,r=r<10?"0"+r:r,s=s<10?"0"+s:s,e?"".concat(i,"/").concat(c,"/").concat(o):"".concat(n,":").concat(r,":").concat(s)},!e||"string"!=typeof e)throw new Error('Chart selector is mandatory, e.g. "#tinyChart"');this.rawPoints=i,this.options=c,this.options.colors=c.colors||[],this.colors=[].concat(_toConsumableArray(this.options.colors),["#00458B","#FB8122","#3EB650","#5626C4","#2CCCC3","#FCC133","#E5BACE","#8DA242","#7DA2A9"]),this.labels=c.labels||[],this.symbols=c.symbols||[],this.chartTypes=c.chartTypes||[],this.delimiters=c.delimiters||[],this.ratio=window.devicePixelRatio||1,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var o=document.createElement("div"),n=document.createElement("div"),r=document.createElement("button");r.innerText="Reset",o.appendChild(r),n.appendChild(this.canvas),this.parent=document.querySelector(e),this.parent.appendChild(o),this.parent.appendChild(n),this.clientRect=this.canvas.getBoundingClientRect(),this.isPressed=!1,this.zoom=!1,this.pointerX=0,this.linesY=4,this.linesX=7,this.recX1=0,this.recX2=0,this.zeroY=0,this.DEFAULT_HEIGHT=300,this.MARGIN_LEFT=this.ctx.measureText(this.symbols[0]).width+45,this.MARGIN_RIGHT=10,this.MARGIN_TOP=15,this.MARGIN_BOTTOM=80,o.style.display="flex",o.style.flexDirection="column",r.style.marginRight="".concat(this.MARGIN_RIGHT,"px"),r.style.marginLeft="".concat(this.MARGIN_LEFT,"px"),this.draw(),window.addEventListener("resize",this.draw),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("touchstart",this.onTouchStart),this.canvas.addEventListener("touchmove",this.onTouchMove),this.canvas.addEventListener("touchend",this.onTouchEnd),r.addEventListener("click",this.resetPoints)};